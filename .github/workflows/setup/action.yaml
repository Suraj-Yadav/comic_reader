name: 'Build'
inputs:
  output:
    required: true
runs:
  using: "composite"
  steps:
    - name: Restore vcpkg binary cache
      uses: actions/cache@v3
      with:
        path: /home/.cache/vcpkg
        key: vcpkg-bin-${{ runner.os }}-${{ hashFiles('vcpkg.json') }}
        restore-keys: |
          vcpkg-bin-${{ runner.os }}-
    - name: build
      env:
        VCPKG_BINARY_SOURCES: "clear;files,/home/.cache/vcpkg,readwrite"
      shell: bash
      run: bash ./resource/builder.sh
    - uses: actions/upload-artifact@v4
      if: ${{ startsWith(github.ref, 'refs/tags/v') && runner.os == 'Windows' }}
      with:
        name: ${{ inputs.output }}
        path: build/comic_reader-win64.zip
    - uses: actions/upload-artifact@v4
      if: ${{ startsWith(github.ref, 'refs/tags/v') && runner.os == 'Linux' }}
      with:
        name: ${{ inputs.output }}
        path: |
          build/Comic_Reader-x86_64.AppImage
          build/Comic_Reader-x86_64.AppImage.zsync
